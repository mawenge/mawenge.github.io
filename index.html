<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="记录我的想写下的东西">
<meta property="og:type" content="website">
<meta property="og:title" content="MaWenge&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="MaWenge&#39;s Blog">
<meta property="og:description" content="记录我的想写下的东西">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MaWenge&#39;s Blog">
<meta name="twitter:description" content="记录我的想写下的东西">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> MaWenge's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">MaWenge's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/14/软件分层设计思想/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Turbo">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/portrait.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="MaWenge's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="MaWenge's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/14/软件分层设计思想/" itemprop="url">
                  软件分层设计思想
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-14T15:43:12+08:00">
                2017-11-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/14/软件分层设计思想/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/11/14/软件分层设计思想/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是分层"><a href="#什么是分层" class="headerlink" title="什么是分层"></a>什么是分层</h3><p>我所理解的分层，是对    <strong>实现某个功能的过程</strong>    进行分层。实现功能的过程是由 <strong>很多服务有序组合完成</strong>，把相似的服务放在一层当中，把不相似的服务分开，简而言之，就是 <strong>对服务进行分层</strong>。</p>
<h3 id="分层的应用"><a href="#分层的应用" class="headerlink" title="分层的应用"></a>分层的应用</h3><p>分层的思想在各个领域可以说是随处可以看到</p>
<h4 id="房屋建设"><a href="#房屋建设" class="headerlink" title="房屋建设"></a>房屋建设</h4><p>我认为可以分为这几层<br><img src="/img/layer/dichan.png" alt=""></p>
<p>这里的实现的 <strong>功能</strong> 就是 <strong>建好房子并且卖出去</strong>。 我把中间涉及到的服务简单的分成了三层。最上层是地产商经营服务，主要负责房屋销售、融资筹钱等服务；第二层是建筑承包服务，主要负责房屋的建设服务，它接受地产商的指示，最终提供给地产商符合要求的产品；第三层是原料供应商，它负责接受建筑承包商的指示，提供给建筑承包商符合要求的产品。<br>都是上层向下层索要特定需求的产品，下层根据需求提供给上层符合条件的产品，双方都不需要知道对方的实现细节。</p>
<h4 id="网络传输模型"><a href="#网络传输模型" class="headerlink" title="网络传输模型"></a>网络传输模型</h4><p><img src="/img/layer/1.png" alt=""></p>
<p>数据在一个网络中的两台机器之间传输，可以说数据就是在这些层当中不断的流动，最终达到了传输数据的目的。  </p>
<p>首先，每一层实现的功能不同<br><strong>应用层：</strong>OSI参考模型中最靠近用户的一层，是为计算机用户提供应用接口，也为用户直接提供各种网络服务。<br><strong>表示层：</strong>应用层数据的编码和转换功能。用于将计算机内部的多种数据格式转换成通信中采用的标准表示形式。<br><strong>会话层：</strong>会话层就是负责建立、管理和终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和响应组成。<br><strong>传输层：</strong>传输层建立了主机端到端的链接，传输层的作用是为上层协议提供端到端的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题。该层向高层屏蔽了下层数据通信的细节，使高层用户看到的只是在两个传输实体间的一条主机到主机的、可由用户控制和设定的、可靠的数据通路。我们通常说的，TCP UDP就是在这一层。端口号既是这里的“端”。<br><strong>网络层：</strong>本层通过IP寻址来建立两个节点之间的连接，为源端的运输层送来的分组，选择合适的路由和交换节点，正确无误地按照地址传送给目的端的运输层。就是通常说的IP层。这一层就是我们经常说的IP协议层。IP协议是Internet的基础。<br><strong>数据链路层：</strong>将比特组合成字节,再将字节组合成帧,使用链路层地址 (以太网使用MAC地址)来访问介质,并进行差错检测。<br><strong>物理层：</strong>实际最终信号的传输是通过物理层实现的。通过物理介质传输比特流。  </p>
<p>其次，实现每一层功能的对象是不同的<br><img src="/img/layer/2.png" alt=""><br>其中应用层（会话层、表示层、应用层）大多通过软件实现其功能。可以说每一层都有专业的对象负责实现本层的功能。</p>
<p>再其次，每一层遵守的协议也不同<br><img src="/img/layer/3.png" alt="">  </p>
<p><strong>每一层的工作都很明确，从上层接收数据（对于应用层直接传递给下层），根据协议处理或者传输数据，再把数据传递给下一层（对于物理层从上层接收数据传递后继续传递给上层）。每一层只负责依据协议读取数据，处理数据，传递数据。不需要了解上层或者下层的实现细节。如此只要每一层都做好自己的事情，最终就能达到数据传输的目的。</strong><br>这里实现的<strong>功能</strong>就是<strong>完成数据传输</strong>，每一层都提供了服务，最终合起来就共同实现了功能。</p>
<h4 id="后端服务架构"><a href="#后端服务架构" class="headerlink" title="后端服务架构"></a>后端服务架构</h4><p>这里介绍一下目前我自己后端服务的分层架构，也是参考了网络上一些通用的架构方案，没有什么技术含量。<br><img src="/img/layer/4.png" alt=""><br><strong>database layer：</strong>数据库服务，用的是阿里云的rds，基本上就是配置一下就行了。<br><strong>persistence layer：</strong>持久层，用于与数据库直接交互，主要就是增删改查，我用的是mybatis，其实也叫dao层，主要包括定义好的一些mapper的xml文件和接口文件。这里可以把功能抽象在接口里面，用以适配不同的数据库服务。<br><strong>service layer：</strong>服务层，这部分应该是对持久层做了一些原子性更大一些的组合。我个人认为这一部分的思想可以跟关系型数据库的<strong>存储过程</strong>很相似。<br><strong>business layer：</strong>业务层，这里涉及到的就是具体的业务了。比如现在的项目是共享电瓶车租赁。相关的业务就会有租还车，车辆管理等等。业务层可以直接调用持久层，也可以调用服务层。<br><strong>presentation layer：</strong>展示层，负责处理所有的界面展示以及交互逻辑。目前的业务主要就是对移动端请求的处理，现在主要就是各种controller，后台静态页面部署在另一台机器上。</p>
<p>其他一些权限过滤、异常处理等这里暂时先不考虑。</p>
<p>spring框架下的这种架构实现起来也非常容易，代码看起来也很清爽，维护起来也没有什么很大的问题。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>不难发现，分层的思想在生活当中随处可见，分层真的就是一种正确实用的方案吗？这个也是要根据需求以及实际情况衡量。这里我们只讨论分层特点。 </p>
<p>1 分层易于实现分工，每一层人员负责的不同，只需要专注自己的业务即可。<br>2 分层易于实现代码复用，这也是分层出现的一个直接原因。<br>3 分层易于测试。由于实现了分层，功能粒度理论上是可以做到很细，单元测试用例编写也会非常灵活。</p>
<p>参考<br><a href="http://blog.csdn.net/bboyfeiyu/article/details/45136299" target="_blank" rel="external">软件架构模式之分层架构</a><br><a href="http://www.infoq.com/cn/articles/several-pain-points-architecture-design" target="_blank" rel="external">针对架构设计的几个痛点，我总结出的架构原则和模式</a><br><a href="https://www.cnblogs.com/qishui/p/5428938.html" target="_blank" rel="external">OSI七层模型与TCP/IP五层模型</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/07/设计模式-代理模式/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Turbo">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/portrait.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="MaWenge's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="MaWenge's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/07/设计模式-代理模式/" itemprop="url">
                  设计模式----代理模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-07T16:08:13+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/07/设计模式-代理模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/11/07/设计模式-代理模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>即<strong>Proxy Pattern</strong>，什么是代理模式呢？</p>
<blockquote>
<p>为其他对象提供一种代理以控制对这个对象的访问。在某些情况下，一个对象不适合或者不能直接引用另一个对象，而代理对象可以在客户端和目标对象之间起到中介的作用。</p>
<p>来自 百度百科</p>
</blockquote>
<p>所谓代理，就是调用对象的方法的时候没有直接调用该对象，而是生成一个代理对象，实际上是代理对象通过真实对象执行方法。</p>
<p>为什么要这样做呢？我们接着往下看</p>
<h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><p><strong>抽象角色：</strong>通过接口或抽象类声明真实角色实现的业务方法。<br><strong>真实角色：</strong>实现抽象角色，定义真实角色所要实现的业务逻辑，供代理角色调用。<br><strong>代理角色：</strong>实现抽象角色，是真实角色的代理，通过真实角色的业务逻辑方法来实现抽象方法，并可以附加自己的操作。</p>
<p>抽象角色声明方法，不提供具体实现；真实角色实现或者继承了抽象角色，实现了里面的方法。代理角色代理真实对象（当然代理角色也是可以直接代理抽象角色的，这个后续具体分析）<br><img src="/img/daili_1.png" alt=""></p>
<h3 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h3><p>抽象角色</p>
<pre><code>public interface User{
    void hello();
}
</code></pre><p>真实角色</p>
<pre><code>public class UserImpl implements User{

    @Override
    public void hello() {
        System.out.println(&quot;大家好，我是小明&quot;);
    }
}
</code></pre><p>代理角色</p>
<pre><code>public class UserProxy implements User{

    private User user;

    public UserProxy(User user) {
        this.user = user;
    }

    @Override
    public void hello() {
        long start = System.currentTimeMillis();
        System.out.println(&quot;start   :   &quot; + start);
        user.hello();
        long end = System.currentTimeMillis();
        System.out.println(&quot;end   :   &quot; + end);
    }
}
</code></pre><p>生成静态代理工厂类</p>
<pre><code>public class UserFactory {
    public static User getInstance(){
        return new UserProxy(new UserImpl());
    }
}
</code></pre><p>使用</p>
<pre><code>@Test
public void staticProxyTest(){
    User instance = UserFactory.getInstance();
    instance.hello();
}
</code></pre><p>结果</p>
<center><br><img src="/img/daili_2.png" alt=""><br></center>


<p>静态代理的优缺点：<br>优点：业务类只需要关注业务逻辑本身，保证了业务逻辑的重用性。<br>缺点：<br>1）代理对象的一个接口只服务于一种类型的对象，如果接口里面的方法很多，就要在每一个方法里面进行代理。<br>2）如果接口里面新增了方法，那么所有的代理类和实现类都要跟着改动。</p>
<p>举例：代理可以对实现类进行统一管理，比如我们要查看一个方法的执行时间，就可以在代理类的实现方法中记录时间，而实现类的代码不需要做修改，这样就避免了修改具体的实现类。但是，如果每一个实现类都要实现这个功能的话，就需要添加多个代理类，以及代理类中凡是需要记录时间的方法都要实现统计时间的功能。<br>即 静态代理只能为特定接口服务，如果想要为多个接口服务则需要建立多个代理类</p>
<h3 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h3><p>根据上面的说法，静态代理的每一个代理类只能代理一个接口，如果被代理的类实现多个接口，那么，势必会产生多个代理类，这也是不可取的？动态代理的出现解决了这个问题</p>
<p><strong>动态代理类的源码实在程序运行期间由jvm根据反射等机制动态生成，所以不存在代理类的字节码文件。代理类和委托类的关系是在程序运行时确定的</strong></p>
<p>Java动态代理有两种实现方式：<strong>jdk动态代理</strong>和<strong>cglib动态代理</strong>。两种方法同时存在，各有优劣。jdk动态代理是由java内部的反射机制来实现的，cglib动态代理底层则是借助asm来实现的。总的来说，反射机制在生成类的过程中比较高效，而asm在生成类之后的相关执行过程中比较高效（可以通过将asm生成的类进行缓存，这样解决asm生成类过程低效问题）。还有一点必须注意：jdk动态代理的应用前提，必须是目标类基于统一的接口。如果没有上述前提，jdk动态代理不能应用。由此可以看出，jdk动态代理有一定的局限性，cglib这种第三方类库实现的动态代理应用更加广泛，且在效率上更有优势。</p>
<h4 id="jdk动态代理"><a href="#jdk动态代理" class="headerlink" title="jdk动态代理"></a>jdk动态代理</h4><pre><code>//接口1
public interface Dog {
    void bark();
}

//接口2
public interface Fish {
    void swim();
}

//实现类
public class RealObject implements Dog, Fish {

    @Override
    public void bark() {
        System.out.println(&quot;汪汪汪&quot;);
    }

    @Override
    public void swim() {
        System.out.println(&quot;~~~~~~~~~~~~~~~  swim  ~~~~~~~~~~~~~~~&quot;);
    }
}

//InvocationHandler实现类
public class InvocationHandlerImpl implements InvocationHandler {
    private Object object;//被代理的真实类

    //构造方法
    public InvocationHandlerImpl(Object object) {
        this.object = object;
    }

    /**
     * @param proxy  被代理的对象
     * @param method 要调用的方法
     * @param args   方法调用时所传入的参数
     * @return
     * @throws Throwable
     */
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println(&quot;开始代理。。。。。。&quot;); //方法被执行之前可以进行自定义操作
        Object invoke = method.invoke(object, args);//执行被代理类的方法（这一步如果没有必要的话是可以省略的，比如retrofit的做法）
        System.out.println(&quot;代理完了。。。。。。&quot;);//方法被执行之后也可以进行自定义操作
        return invoke;
    }
}

@Test
public void test1() {
    //真实对象
    Object realObject = new RealObject();
    //代理对象
    Object proxy = Proxy.newProxyInstance(getClass().getClassLoader(), realObject.getClass().getInterfaces(), new InvocationHandlerImpl(realObject));
    //代理对象执行方法
    //这里的代理对象只能强转成接口对象，而且只能强转成单个接口对象执行接口中所声明的方法
    ((Dog) proxy).bark();
    System.out.println();
    ((Fish) proxy).swim();
}
</code></pre><p>输出<br><img src="/img/daili_3.png" alt=""></p>
<p>接口实现类如果没有必要的话是可以不用实现的，InvocationHandler 当中也不用传入被代理的对象，invoke方法中也不用调用Object invoke = method.invoke(object, args);这句话，只需要在invoke中做其他事情即可，Android当红网络框架Retrofit就是这样操作的，后续会有文章讲解。</p>
<p>jdk动态代理说起来就是这几下，Proxy.newProxyInstance 生成代理对象，在invoke做操作，其他的其实也没有了。</p>
<h4 id="cglib-动态代理"><a href="#cglib-动态代理" class="headerlink" title="cglib 动态代理"></a>cglib 动态代理</h4><p>Cglib是一个优秀的动态代理框架，它的底层使用ASM在内存中动态的生成被代理类的子类，使用CGLIB即使代理类没有实现任何接口也可以实现动态代理功能。CGLIB具有简单易用，它的运行速度要远远快于JDK的Proxy动态代理：</p>
<p>CGLIB的核心类：<br>    net.sf.cglib.proxy.Enhancer – 主要的增强类<br>    net.sf.cglib.proxy.MethodInterceptor – 主要的方法拦截类，它是Callback接口的子接口，需要用户实现<br>    net.sf.cglib.proxy.MethodProxy – JDK的java.lang.reflect.Method类的代理类，可以方便的实现对源对象方法的调用,如使用：<br>    Object o = methodProxy.invokeSuper(proxy, args);<br>net.sf.cglib.proxy.MethodInterceptor接口是最通用的回调（callback）类型，它经常被基于代理的AOP用来实现拦截（intercept）方法的调用。这个接口只定义了一个方法<br>public Object intercept(Object object, java.lang.reflect.Method method,<br>Object[] args, MethodProxy proxy) throws Throwable;</p>
<p>第一个参数是代理对像，第二和第三个参数分别是拦截的方法和方法的参数。原来的方法可能通过使用java.lang.reflect.Method对象的一般反射调用，或者使用 net.sf.cglib.proxy.MethodProxy对象调用。net.sf.cglib.proxy.MethodProxy通常被首选使用，因为它更快。</p>
<pre><code>//真实类
public static class Dog {
    public void bark() {
        System.out.println(&quot;汪汪汪~~~~~~~~~~~~~~~~~~~~~~&quot;);
    }
}

public static class  CglibProxy implements MethodInterceptor {
    private Object o;
    public CglibProxy(Object o) {
        this.o = o;
    }

    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
        System.out.println(&quot;before      &quot; + methodProxy.getSuperName());
        Object invoke = methodProxy.invoke(this.o, objects);//代理类调用真实对象执行方法
        System.out.println(&quot;after      &quot; + methodProxy.getSuperName());
        return invoke;
    }
}

public static void main(String[] args){
    Dog target = new Dog();
    CglibProxy proxy = new CglibProxy(target);
    Enhancer enhancer = new Enhancer();
    enhancer.setSuperclass(target.getClass());
    enhancer.setCallback(proxy);
    //生成代理类
    Dog dog = (Dog) enhancer.create();
    dog.bark();
}
</code></pre><p>执行结果<br><img src="/img/daili_4.png" alt=""></p>
<p>cglib实现了对实体类的动态代理，弥补了jdk动态代理只能对接口代理的缺陷<br>cglib的研究还是很不透彻，后续会有更深入的研究(Superclass has no null constructors but no arguments were given)，也遇到了问题，后续研究spring aop的时候会做深入研究。<br><a href="http://netfork.iteye.com/blog/286215" target="_blank" rel="external">通过CGLIB实现AOP的浅析（顺便简单对比了一下JDK的动态代理）</a></p>
<h4 id="动态代理小结"><a href="#动态代理小结" class="headerlink" title="动态代理小结"></a>动态代理小结</h4><p>动态代理与静态代理相比较，最大的好处是接口中声明的所有方法都被转移到调用处理器一个集中的方法中处理（InvocationHandler.invoke）。这样，在接口方法数量比较多的时候，我们可以进行灵活处理，而不需要像静态代理那样每一个方法进行中转。在本示例中看不出来，因为invoke方法体内嵌入了具体的外围业务，实际中可以类似Spring AOP那样配置外围业务。 还可以根据方法的不同做不同的操作。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>代理的目的就是通过代理在核心主要任务执行的前后做一些其他操作，不影响核心业务代码，保证核心业务代码的纯净性。也有助于功能模块化，实现功能插拔式的操作，也就实现了解耦。例如访问Google，可以在访问之前做一个翻墙操作，然后再进行实质的网络请求。如果有一天不需要翻墙了，那么从项目中剥离翻墙代码也是很容易的。</p>
<p>参考<br><a href="http://layznet.iteye.com/blog/1182924" target="_blank" rel="external">java静态代理和动态代理</a><br><a href="http://blog.csdn.net/hejingyuan6/article/details/36203505" target="_blank" rel="external"> JAVA学习篇–静态代理VS动态代理</a><br><a href="http://blog.csdn.net/heyutao007/article/details/49738887" target="_blank" rel="external">Java动态代理的两种实现方法</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/29/新建文章标题/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Turbo">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/portrait.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="MaWenge's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="MaWenge's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/29/新建文章标题/" itemprop="url">
                  新建文章标题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-29T13:50:04+08:00">
                2017-10-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/29/新建文章标题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/10/29/新建文章标题/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/03/设计模式-单一职责原则/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Turbo">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/portrait.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="MaWenge's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="MaWenge's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/03/设计模式-单一职责原则/" itemprop="url">
                  设计模式----单一职责原则
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-03T21:51:54+08:00">
                2017-02-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/03/设计模式-单一职责原则/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/03/设计模式-单一职责原则/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h2><p>面向对象的编程有很多的设计模式，例如单例模式，观察者模式，装饰者模式等等，这些模式适用于不同的场景，但是这些设计模式又遵循几个相同的原则，可以说这些原则是所有设计模式的基础</p>
<ol>
<li><strong>单一职责原则</strong></li>
<li><strong>里氏替换原则</strong></li>
<li><strong>依赖倒置原则</strong></li>
<li><strong>接口隔离原则</strong></li>
<li><strong>迪米特法则</strong></li>
<li><strong>开闭原则</strong></li>
</ol>
<p>如果能够很好地理解这些原则，对以后学习具体的设计模式将会有很大的帮助，所以这里我也结合所看的书籍并结合自己的理解深入剖析每种原则的含义。如果发现有不准确的地方，欢迎留言交流，共同进步。</p>
<h2 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h2><p>单一职责的英文名称是<strong>Single Responsibility Principle</strong>，简称SRP。SRP原话解释如下：</p>
<blockquote>
<p>There should never be more than one reason for a class to change<br>应该有且只有一个原因引起类的变更</p>
</blockquote>
<p>其实单一职责这句话本身就已经说得很清楚了，就是一个类只负责一件事，不负责其他的事情。而能够引起这个类变化的原因也是只有这个类负责的事情。</p>
<p>这里举一个例子，也是书上的例子：<br>打电话需要四个过程，拨号、通话、回应、挂机，现在写一个接口如下<br><img src="/img/1.png" alt=""></p>
<p>这三个方法都是电话的功能，把他们全都放在IPhone的接口中也是非常合理的。而且它就负责一件事，电话的事情，但只有一个原因引起变化吗？好像不是<br>IPhone这个接口其实有两个职责：一是协议管理，二是数据传送。dial() hangup()实现的是协议管理，分别负责拨号接通和挂机；chat()实现的是数据的传送，把模拟信号转换成数字信号等等。协议的变化和数据传送的变化都能够引起接口或实现类的变化。那么协议控制和数据传送之间相互依赖吗？电话拨号，我们只要接通就成，甭管是电信还是网通的协议；电话接通后我们也不关心传递的是什么数据。通过这样的分析我们发现类图上的IPhone接口包含了两个职责，而且这两个职责的变化不会相互影响，那就考虑拆分成两个接口<br><img src="/img/2.png" alt=""></p>
<p>那么这么做到底能有什么好处呢，请看下面：</p>
<ol>
<li><p>我们使用的是面向接口的编程，所以暴露给使用者的是两个接口类型IConnectionManager和IDataTransfer。使用者只能调用接口中声明的方法。面向接口编程实现了方法的隔离，使得使用者只需要使用方法即可，不需要知道具体实现，并且只能使用该接口的方法。所以在业务层面与协议有关的就是IConnectionManager，而与数据传输相关的就是IDataTransfer，到时候如果修改了接口里面的内容，业务调用层需要修改的内容范围也会减小（例如如果修改了数据传输IDataTransfer，那么业务层只需要修改IDataTransfer有关的内容，IConnectionManager相关的内容则完全不用修改，找起来也方便一点，如果没有拆分成两个接口，那么就要找到所有IPhone接口使用的地方一一检查）</p>
</li>
<li><p>这里的实现类Phone仍然实现了打电话有关的所有功能，只不过对于不同的使用情况通过接口类型暴露不同的方法给调用者。那么有人肯定要问为什么不定义两个实现类分别实现IConnectionManager和IDataManager，然后分别把两个实现类的对象传递给接口对象。这里IConnectionManager和IDataManager的实现方法如果要共享数据的话，那么让Phone类同时实现IConnectionManager和IDataManager接口，这样就可以很方便的在类内部维护共享数据以及状态，而通过接口对外暴露功能方法，类的结构也很清晰。还有一种就是Phone类组合IConnectionManager和IDataManager的实现类，但是组合是一种强耦合关系，而且还增加了类的复杂性，多了两个类，还不如直接让Phone类实现IConnectionManager和IDataManager接口。</p>
</li>
</ol>
<p>单一职责原则提出了一个编写程序的标准，用“职责”或“变化原因”来衡量接口或类设计得是否优良，但是“职责”和“变化原因”都是不可度量的，因项目而异，因环境而异。</p>
<p>上面的例子从功能上来说，定义一个IPhone接口来说也是没有错的，实现了电话的功能，而且设计还很简单，仅仅定义一个接口和一个实现类。但是确实是有两个可以变化的原因放到了一个接口里面，这就为以后的变化带来了风险。如果以后模拟电话升级到数字电话，我们提供的接口IPhone是不是要修改了？接口修改对其他的Invoker类是不是有很大的影响？</p>
<p>单一职责适用于接口、类，同时也适用于方法。一个方法尽量做一件事。我相信大多数人编程的时候突然发现接下来要写的一段代码以前好像写过，然后回去把那段代码又提取出来变成一个单独的方法。这就时前面设计方法的时候做了太多事情，粒度太大了，相信大多数人多方法的单一职责还是比较容易理解的。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/07/android-ptp-编程（1）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Turbo">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/portrait.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="MaWenge's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="MaWenge's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/07/android-ptp-编程（1）/" itemprop="url">
                  android ptp 编程（1）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-07T17:01:06+08:00">
                2017-01-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/07/android-ptp-编程（1）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/07/android-ptp-编程（1）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近公司用到一个项目，android手机通过<a href="http://baike.baidu.com/link?url=j92Z7WzjziSGlCVRjEIbmKyBzXzjZGf90Kd7J6RWWWL4YnFToL-KhVejy0fr2KeuiM_u_6wMdTXgSh7U-Xb80_" target="_blank" rel="external">OTG</a>与单反相机实现连接，实现相机中有新增图片的时候自动保存到手机当中，然后手机自动上传到自己的服务器上。后面一步是比较常规的操作，一般都可以实现，主要是前一步。这个系列将介绍我如何一步步实现这些功能以及踩到的一些坑(文中很多链接需要自备梯子)</p>
<p>以下介绍相关概念</p>
<h2 id="PTP协议-picture-transfer-protocol"><a href="#PTP协议-picture-transfer-protocol" class="headerlink" title="PTP协议(picture transfer protocol)"></a>PTP协议(picture transfer protocol)</h2><blockquote>
<p>Picture Transfer Protocol (PTP) is a protocol developed by the International Imaging Industry Association to allow the transfer of images from digital cameras to computers and other peripheral devices without the need of additional device drivers. The protocol has been standardised as ISO 15740.</p>
<p>It is further standardized for USB by the USB Implementers Forum as the still image capture device class. USB is the default network transport media for PTP devices. USB PTP is a common alternative to the USB mass-storage device class (USB MSC), as a digital camera connection protocol. Some cameras support both modes.</p>
</blockquote>
<p>这是维基百科对ptp的描述。可见主要是数码相机与外部设备通信的一种协议。</p>
<p>PTP是最早由柯达与微软协商制定的一种标准，符合这种标准的图像设备在接入Windows XP系统之后可以更好地被系统和应用程序所共享，尤其在网络传输方面，系统可以直接访问这些设备用于建立网络相册时图片的上传、网上聊天时图片的传送等。</p>
<h2 id="MTP媒体传输协议（Media-Transfer-Protocol，MTP）"><a href="#MTP媒体传输协议（Media-Transfer-Protocol，MTP）" class="headerlink" title="MTP媒体传输协议（Media Transfer Protocol，MTP）"></a>MTP媒体传输协议（Media Transfer Protocol，MTP）</h2><blockquote>
<p>媒体传输协议（Media Transfer Protocol，MTP）是一个基于图片传输协议（Picture Transfer Protocol，PTP）的自定义扩展协议。该协议允许用户在移动设备上线性访问媒体文件。PTP只是被设计用于从数码相机下载照片，而MTP可以支持数字音频播放器上的音乐文件和便携式媒体播放器上的媒体文件，以及个人数字助理的个人信息的传输。MTP是WMDRM10-PD的一个关键部分，而WMDRM10-PD是Windows Media的一项数字版权管理（DRM）服务。</p>
<p>媒体传输协议（即通常所说的MTP）是“Windows Media”框架的一部分，从而与Windows Media Player密切相关。Windows系统从Windows XP SP2开始支持MTP。Windows XP需要安装Windows Media Player 10或更高版本来获得对MTP的支持。在这之后的系统则原生支持MTP。微软同时向Windows98之后的旧有操作系统提供MTP驱动包。OS X 和 Linux 各自拥有可支持MTP的升级软件包. (维基百科)</p>
</blockquote>
<p>mtp明显是ptp的升级版，从仅传输图片文件到传输媒体文件，包括音频视频文件。对于ptp协议和mtp协议的具体文件我也是都有看过一遍，mtp当中很多指令等都于ptp完全相同，在我看来就是新增了一些东西，新增的部分我也没有多看，项目进度原因，也没有深究。</p>
<h2 id="PIMA15740-2000"><a href="#PIMA15740-2000" class="headerlink" title="PIMA15740:2000"></a>PIMA15740:2000</h2><p><a href="https://people.ece.cornell.edu/land/courses/ece4760/FinalProjects/f2012/jmv87/site/files/pima15740-2000.pdf" target="_blank" rel="external">文档下载</a><br>那么这个pima 15740又是什么呢</p>
<blockquote>
<p>The technical content of this PIMA standard is closely related to ISO 15740, which is currently<br>in the working draft stage while work on multiple transports is being completed. The main difference is that PIMA 15740  ncludes an informative annex describing a USB implementation of ISO 15740. This information is not included in ISO 15740,  hich instead references the USB still device class document developed by the Device Working Group of the USB Implementers Forum. The USB annex in PIMA 15740 provides the same technical approach as the USB still device class specification. The  eason for developing PIMA 15740 is to immediately provide a complete, fully documented, stable, publicly available pecification  or USB implementations of the Picture Transfer Protocol defined in ISO 15740. This will enable hardware and software   nufacturers to immediately produce product implementations, without waiting for the ISO and USB documents to complete the approval process. This PIMA 15740 standard may be withdrawn once the ISO 15740 and USB still device class documents have  een approved and are publicly available. </p>
</blockquote>
<p>上面这段话清楚地写出，pima15740 是usb实现的pima15740，就是为了提供一个完整的，稳定的，文档化的基于usb通信协议的iso15740，也就是基于usb的ptp协议。看到这里大家应该差不多明白了，我的需求基本上就是这个了。</p>
<h2 id="实现分析"><a href="#实现分析" class="headerlink" title="实现分析"></a>实现分析</h2><h3 id="android-hardware-usb"><a href="#android-hardware-usb" class="headerlink" title="android.hardware.usb"></a>android.hardware.usb</h3><p>首先查看安卓官方文档会发现有一个<a href="https://developer.android.google.cn/reference/android/hardware/usb/package-summary.html" target="_blank" rel="external">android.hardware.usb</a>这样一个包，安卓本身提供了这样一套api用于获取连接在android手机上的usb设备，并且进行相应的通信。连接usb设备一共有两种模式，一种Host模式，一种Accessary模式，前者相当于android手机是老大，连接的设备是奴隶，手机可以进行任何操作；后一种是相当于连接的设备是老大，android手机是奴隶。具体可以看看<a href="http://www.voidcn.com/blog/Ever_GZ/article/p-4859973.html" target="_blank" rel="external">这篇文章</a>,百度也可以搜出来一大堆文章，基本上学习这个结合官方文档一般人都不会有问题，只要静下心来都不会有问题。</p>
<p><img src="/img/android_usb.png" alt="android.hardware.usb"><br>不管如何跟相机通信，必须首先拿到连接到手机上的UsbDevice对象，才能进行下一步的操作。</p>
<h3 id="android-mtp"><a href="#android-mtp" class="headerlink" title="android.mtp"></a>android.mtp</h3><p>接着会发现还有一个<a href="https://developer.android.google.cn/reference/android/mtp/package-summary.html" target="_blank" rel="external">android.mtp</a>的包，这个也是android自身实现的一个跟mtp设备通信的api。用法也十分简单，文档上面介绍的也是非常的详细，这里我简单介绍一下：<br><img src="/img/android_mtp.png" alt="android.hardware.usb"></p>
<p>1、获取UsbDevice设备 和UsbDeviceConnection，获取看上一小节的链接<br>2、获取MtpDevice对象然后建立连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MtpDevice mtpDevice = new MtpDevice(mUsbDevice);</div><div class="line">mtpDevice.open(mDeviceConnection)</div></pre></td></tr></table></figure><br>3、然后就可以用MtpDevice对象获取各种有用的信息，MtpDevice的方法也不多，直接点进去就可以看<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">close()</div><div class="line">deleteObject(int objectHandle)</div><div class="line">getDeviceId()</div><div class="line">getDeviceInfo()</div><div class="line">getDeviceName()</div><div class="line">getObject(int objectHandle, int objectSize)</div><div class="line">getObjectHandles(int storageId, int format, int objectHandle)</div><div class="line">getObjectInfo(int objectHandle)</div><div class="line">getParent(int objectHandle)</div><div class="line">getStorageId(int objectHandle)</div><div class="line">getStorageIds()</div><div class="line">getStorageInfo(int)</div><div class="line">getStorageInfo(int storageId)</div><div class="line">getThumbnail(int objectHandle)</div><div class="line">importFile(int objectHandle, String destPath)</div><div class="line">importFile(int objectHandle, ParcelFileDescriptor descriptor)</div><div class="line">open(UsbDeviceConnection connection)</div><div class="line">readEvent(CancellationSignal signal)</div><div class="line">sendObject(int objectHandle, long size, ParcelFileDescriptor descriptor)</div><div class="line">sendObjectInfo(MtpObjectInfo info)</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line"></div></pre></td></tr></table></figure></p>
<p>是不是很方便，看方法的字面意思基本上就知道用法了，用起来真的没难度，so easy，而且这里面的好多方法都是我需要的，你以为到这里就能解决我的问题了吗，一开始我也是这样人为的，后来才发现还是太年轻。。。</p>
<p>mtp这个包其实就是google自身基于mtp和usb通信协议实现的，具体实现还是调用native方法实现的，所以我还看不到每个方法的具体实现细节。我用这一套api确实可以读取到相机中的所有文件，并且可以手动复制相机中的图片到手机中（注意是手动，和我的需求还有一些不同）。我需要的是自动复制，大家肯定看到了还有一个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">readEvent(CancellationSignal signal)</div></pre></td></tr></table></figure><br>这个方法可以接收相机的事件，当有新的图片的时候就会发送一个事件编号位ObjectAdded的事件，然后我就可以主动拉取这个照片了，是不是很完美。可是我用的时候又发现只有api24才能用。。。所以这个方案也不行了。除了这一点，还有一个致命的问题，那就是我有些手机通过这种方式连接到相机之后相机被锁定了，不能继续拍照了，关于这个问题我还和<a href="http://weibo.com/innost?is_all=1" target="_blank" rel="external">阿拉神农</a>,做了简单的交流，虽然没有解决问题，但是还是感谢他。这个问题后来我大致明白了，应该是不同手机在连接相机的时候对相机的mode进行了设置，所以会导致相机不能工作。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>通过这些坑，我明白了使用android现成的mtp包里面的接口暂时是无法实现我的需求了，一切有都得从长计议了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/26/yiyang/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Turbo">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/portrait.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="MaWenge's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="MaWenge's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/26/yiyang/" itemprop="url">
                  写给一阳的
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-26T22:50:04+08:00">
                2016-12-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/26/yiyang/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/26/yiyang/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们是在2016.12.12在我科上海校友会上认识的</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/portrait.jpg"
               alt="Turbo" />
          <p class="site-author-name" itemprop="name">Turbo</p>
          <p class="site-description motion-element" itemprop="description">记录我的想写下的东西</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/mawenge" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Turbo</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  







  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  


  
  

  

  

  

  


</body>
</html>
